
let module = (function(){
	var data = {
		form_rg: document.querySelector('.form-horizontal'),
		form_rg_to_complete: document.querySelector('.form-to-complete'),
		btn_rg: document.querySelector('.btn-rg'),
		btn_rgs:document.querySelector('.btn-rgs'),
		alert: document.querySelector('.alert')
	};

	var contructor = function(){
		this.events = initEvents();

	};

	let initEvents = function(){
		validate_form();
		console.log(data.btn_rgs!=null);
		if(data.btn_rgs != null){data.btn_rgs.addEventListener('click',save_data_register_to_compete);}
		
	}

	function show_alert_success(){
		data.alert.classList.add('alert-success');
		data.alert.classList.remove('alert-danger');
	}

	function show_alert_danger(){
		data.alert.classList.remove('alert-success');
		data.alert.classList.add('alert-danger');
	}

	let request_ = function(url_,form_){
		var dataForm = new FormData(form_);
		console.log(dataForm.get('name') + ' - ' + dataForm.get('email') + ' - ' + dataForm.get('pass'));
		$.ajax({
			url:url_,
			type:"POST",
			data:dataForm,
			processData: false,
        	contentType: false,
			beforeSend: function(){
				document.querySelector('.container_circle_preloader').classList.add('active');
			},

			complete: function(){
				document.querySelector('.container_circle_preloader').classList.remove('active');
			},

			success:function(call)
			{
				let parse_data = JSON.parse(call);
				console.log(call);
				if(parse_data.action == "true"){
					console.log("success");
					window.location = parse_data.URL;
				}else{
					show_alert_danger();
					data.alert.style.display = "block";
					document.querySelector('.container-form-rg').style.marginTop = '10px';

				}
			}

		})
	}

	let valiate_email = email => {
		rg_expr = /^[-\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\.){1,125}[A-Z]{2,63}$/i;

		if(rg_expr.test(email)){
			return true;
		}else{
			return false;
		}
	
	};

	let save_data_register_to_compete = (e) => {
		e.preventDefault();
		data.state = false;
		let size_complete = 0;
		for(let i = 0; i < data.form_rg_to_complete.elements.length; i++)
		{
			console.log(data.form_rg_to_complete.elements[i].tagName);
			if(data.form_rg_to_complete.elements[i].tagName == "INPUT" || data.form_rg_to_complete.elements[i].tagName == "SELECT")
			{
				if(data.form_rg_to_complete.elements[i].value.length == 0)
				{
				  data.state = false;
				  size_complete--;
			    }else{
				  data.state = true;
				  size_complete++;
				}
			}
		}

		if(data.state && size_complete == (data.form_rg_to_complete.elements.length-2))
		{
			let form_ = $('.form-to-complete')[0]; 
			request_("/website-testing/borrower/register_complete_one/",form_);
			show_alert_success();
			data.alert.style.display = "block";
			document.querySelector('.container-form-rg').style.marginTop = '10px';
			data.state = false;
		}else{
			show_alert_danger();
			data.alert.style.display = "block";
			document.querySelector('.container-form-rg').style.marginTop = '10px';
			data.state = false;
		}
		console.log(size_complete + ' - ' + (data.form_rg_to_complete.elements.length-2));
	}

	let loop_form = (e) => {
		e.preventDefault();
		data.state = false;
		let size_complete = 0;
		for(let i = 0; i < data.form_rg.elements.length; i++)
		{
			if(data.form_rg.elements[i].tagName == "INPUT")
			{
				if(data.form_rg.elements[i].type == "email")
				{
					if(valiate_email(data.form_rg.elements[i].value))
					{
						data.state = true;
				  		size_complete++;
					}else{
						data.state = false;
				  		size_complete--;
					}
				}else if(data.form_rg.elements[i].type == "text" || data.form_rg.elements[i].type == "password")
				{
					if(data.form_rg.elements[i].value.length == 0)
					{
				  	data.state = false;
				  		size_complete--;
					}else{
				  		data.state = true;
				  		size_complete++;
					}
				}else{
					data.state = true;
				  	size_complete++;
				}
				
			}
		}
		
		if(data.state && size_complete == (data.form_rg.elements.length-1))
		{
			let form_ = $('.form-horizontal')[0];
			request_("/website-testing/borrower/register_/",form_);
			show_alert_success();
			//data.alert.style.display = "block";
			document.querySelector('.form-horizontal').style.marginTop = '10px';
			data.state = false;
		}else{
			show_alert_danger();
			data.alert.style.display = "block";
			document.querySelector('.form-horizontal').style.marginTop = '10px';
			data.state = false;
		}
	};

	var validate_form = function(){
		if(data.btn_rg != null)
		{
			data.btn_rg.addEventListener("click",loop_form);
		}
		
	}

	return {
		__init__: contructor
	}
})();

var instance = module.__init__();
