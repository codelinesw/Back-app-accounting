var module_calendar = (function(){

	var data = {};
	data.button_next = document.querySelector('.btn_next_month');	
	data.button_previous = document.querySelector('.btn_prev_month');
	data.btn_day = document.querySelector('.btn-day');
	data.btn_month = document.querySelector('.btn-month');
	data.months = [
	'Enero',
	'Febrero',
	'Marzo',
	'Abril',
	'Mayo',
	'Junio',
	'Julio',
	'Agosto',
	'Septiembre',
	'Octubre',
	'Noviembre',
	'Diciembre'
	];
	

	function __construct()
	{
		initDate();
		add_events.enumerate();
		add_events.getCurrentMonth(data.date.getFullYear(),get_month());;
		data.button_next.addEventListener('click',add_events.change_next_month);
		data.button_previous.addEventListener('click',add_events.change_prev_month);
		data.btn_day.addEventListener('click',add_events.show_events_day);
		data.btn_month.addEventListener('click',add_events.show_events_months);
	}


	function initDate(year,month,currentday)
	{
		if(year == undefined && month == undefined)
		{
			data.date = new Date();
		}else{
			data.date = new Date(year,month,currentday);
		}
	
	}
	

	function get_current_year(year_)
	{

		if(year_ == undefined){
			var date = data.date.getFullYear();
  			return date;
		}else{
			var date = year_;
  			return date;
		}
  		
	}

	function clearDom()
	{
		document.querySelector('.table').children[1].innerHTML = "";
	}

	function get_month(){
		return data.date.getMonth();
	}

	function getDay(){
		return data.date.getDate()-1;
	}

	function get_total_days(year,month)
	{
		
		if((year == undefined && month == undefined) || (year == undefined || month == ""))
		{
			return new Date(get_current_year(), get_month(), 0).getDate();
		}else{
			return new Date(year, month, 0).getDate();
		}
	}

	let add_events = {
		start_day: function(year,month){
			return new Date(year,month-1, 1).getDay()
		},
		getCurrentMonth: function(year_,month_){
			document.querySelector('.title-date').innerHTML  = "";
			document.querySelector('.title-date').innerHTML = data.months[month_]+' '+year_;
		},
		enumerate: function(year_,month_)
		{
			var dom = '';
			var start = 0;
			var current_month = (month_ == undefined || month_ == "") ? get_month()+1 : month_;
			var current_year  = (year_ == undefined || year_ == "") ? get_current_year() : year_;

			clearDom();

			for(let j = (add_events.start_day(current_year,current_month)-1); j >= 0 ; j--)
			{
				
				document.querySelector('.table').children[1].innerHTML +=  `<div class="number-day number-days-disabled" style="border-top: 1px solid #dedede;"><button class="btn_choose_day"><p class="day">${((get_total_days()-1) - (j-1))}</p><div class="container-events"><span class="event_ text-truncate rounded bg-success">Festival de amor y amistad</span><span class="event_ text-truncate rounded bg-success">Festival de amor y amistad</span></div><a href="#" class="link-more-events text-dark">+3 mas</a></button></div>`;
				start++;
			}

			for(var i = 0; i < get_total_days(current_year,current_month); i++)
			{	
				if(i == getDay()){
					document.querySelector('.table').children[1].innerHTML +=  `<div class="number-day number-current-day"><button class="btn_choose_day"><p class="day">${(i+1)}</p></button></div>`;
				}else{
					document.querySelector('.table').children[1].innerHTML +=  `<div class="number-day"><button class="btn_choose_day"><p class="day">${(i+1)}</p></button></div>`;
				}
				
				
			}
		},
		change_next_month: function()
		{
			console.log(data.date.getFullYear() + ' - ' + get_month());
			initDate(data.date.getFullYear(),get_month()+1,(getDay()+1));
			add_events.enumerate();
			add_events.getCurrentMonth(data.date.getFullYear(),get_month());
		},
		change_prev_month: function()
		{
			console.log(data.date.getFullYear() + ' - ' + (get_month()-1));
			initDate(data.date.getFullYear(),get_month()-1,(getDay()+1));
			add_events.enumerate();
			add_events.getCurrentMonth(data.date.getFullYear(),get_month());
			
			
		},
		show_events_day: function(e){
			e.preventDefault();
			document.querySelector('.table').children[0].style.display = "none";
			document.querySelector('.table').children[1].style.display = "none";
			document.querySelector('.table').children[2].style.display = "block";
		},
		show_events_months: function(e){
			e.preventDefault();
			document.querySelector('.table').children[0].style.display = "flex";
			document.querySelector('.table').children[1].style.display = "flex";
			document.querySelector('.table').children[2].style.display = "none";
		}
	}

	return {
		init: __construct
	}

}());

mcalendar = module_calendar;
mcalendar.init();