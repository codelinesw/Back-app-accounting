
let module = (function(){
	var data = {
		form_rg: document.querySelector('.form-horizontal'),
		btn_rg: document.querySelector('.btn-rg'),
		alert: document.querySelector('.alert')
	};

	var contructor = function(){
		this.events = initEvents();

	};

	let initEvents = function(){
		validate_form();
	}

	function show_alert_success(){
		data.alert.classList.add('alert-success');
		data.alert.classList.remove('alert-danger');
	}

	function show_alert_danger(){
		data.alert.classList.remove('alert-success');
		data.alert.classList.add('alert-danger');
	}

	let request_ = function(pname,pemail,Ppass){
		$.ajax({
			url:"/website-testing/borrower/register_/",
			type:"POST",
			data:{name:pname,
			email:pemail,
			pass:Ppass},
			beforeSend: function(){
				document.querySelector('.container_circle_preloader').classList.add('active');
			},

			complete: function(){
				document.querySelector('.container_circle_preloader').classList.remove('active');
			},

			success:function(call)
			{
				console.log(call);
				if(call == "true"){
					console.log("success");
				}else{
					console.log("failed");
				}
			}

		})
	}

	let valiate_email = email => {
		rg_expr = /^[-\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\.){1,125}[A-Z]{2,63}$/i;

		if(rg_expr.test(email)){
			//console.log("email valido...");
			return true;
		}else{
			//console.log("email no valido...");
			return false;
		}
	
	};

	let loop_form = (e) => {
		e.preventDefault();
		data.state = false;
		let size_complete = 0;
		for(let i = 0; i < data.form_rg.elements.length; i++)
		{
			if(data.form_rg.elements[i].tagName == "INPUT")
			{
				if(data.form_rg.elements[i].type == "email")
				{
					if(valiate_email(data.form_rg.elements[i].value))
					{
						data.state = true;
				  		size_complete++;
					}else{
						data.state = false;
				  		size_complete--;
					}
				}else if(data.form_rg.elements[i].type == "text" || data.form_rg.elements[i].type == "password")
				{
					if(data.form_rg.elements[i].value.length == 0)
					{
				  	data.state = false;
				  		size_complete--;
					}else{
				  		data.state = true;
				  		size_complete++;
					}
				}else{
					data.state = true;
				  	size_complete++;
				}
				
			}
		}
		
		if(data.state && size_complete == (data.form_rg.elements.length-1))
		{
			request_(data.form_rg.elements[0].value,data.form_rg.elements[1].value,data.form_rg.elements[2].value);
			show_alert_success();
			data.alert.style.display = "block";
			document.querySelector('.container-form-rg').style.marginTop = '10px';
			data.state = false;
		}else{
			show_alert_danger();
			data.alert.style.display = "block";
			document.querySelector('.container-form-rg').style.marginTop = '10px';
			data.state = false;
		}
	};

	var validate_form = function(){
		data.btn_rg.addEventListener("click",loop_form);
	}

	return {
		__init__: contructor
	}
})();

var instance = module.__init__();
